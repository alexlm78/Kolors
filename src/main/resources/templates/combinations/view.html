<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title th:text="${combination.name + ' - Kolors'}">Combinaci√≥n - Kolors</title>
   <link rel="stylesheet" th:href="@{/css/mobile-responsive.css}">
   <link rel="stylesheet" th:href="@{/css/theme.css}">
   <style>
      /* View page specific styles */
      .container {
         max-width: 800px;
      }

      /* Combination Display */
      .combination-display {
         background: #f8f9fa;
         padding: 20px;
         border-radius: 15px;
         margin-bottom: 20px;
         text-align: center;
      }

      .combination-name {
         font-size: 2rem;
         font-weight: 700;
         color: #495057;
         margin-bottom: 15px;
      }

      .combination-meta {
         color: #6c757d;
         font-size: 1rem;
         margin-bottom: 20px;
      }

      .combination-colors {
         display: flex;
         justify-content: center;
         gap: 15px;
         margin-bottom: 20px;
         flex-wrap: wrap;
      }

      .color-display {
         text-align: center;
      }

      .color-box {
         width: 100px;
         height: 100px;
         border-radius: 12px;
         border: 2px solid #e9ecef;
         margin-bottom: 10px;
         box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
         transition: all 0.3s ease;
         cursor: pointer;
         position: relative;
      }

      .color-box:hover {
         transform: translateY(-3px);
         box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      }

      .color-info {
         text-align: center;
      }

      .color-hex {
         font-size: 1rem;
         font-weight: 700;
         color: #495057;
         margin-bottom: 5px;
         font-family: 'Courier New', monospace;
      }

      .color-position {
         color: #6c757d;
         font-size: 0.85rem;
      }

      /* Mobile optimizations for view page */
      @media (max-width: 767px) {
         .combination-display {
            padding: 15px;
         }

         .combination-name {
            font-size: 1.5rem;
            margin-bottom: 10px;
         }

         .combination-meta {
            font-size: 0.9rem;
            margin-bottom: 15px;
         }

         .combination-colors {
            gap: 10px;
            margin-bottom: 15px;
         }

         .color-box {
            width: 70px;
            height: 70px;
            border-radius: 8px;
         }

         .color-hex {
            font-size: 0.85rem;
         }

         .color-position {
            font-size: 0.75rem;
         }
      }

      /* Color Palette Preview */
      .palette-preview {
         background: white;
         padding: 20px;
         border-radius: 10px;
         border: 1px solid #e9ecef;
         margin-bottom: 20px;
      }

      .palette-preview h3 {
         color: #495057;
         margin-bottom: 15px;
         text-align: center;
      }

      .palette-strip {
         height: 80px;
         border-radius: 8px;
         display: flex;
         overflow: hidden;
         box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      }

      .palette-color {
         flex: 1;
         transition: all 0.3s ease;
         cursor: pointer;
         position: relative;
      }

      .palette-color:hover {
         flex: 1.2;
      }

      .palette-color::after {
         content: attr(data-hex);
         position: absolute;
         bottom: 8px;
         left: 50%;
         transform: translateX(-50%);
         background: rgba(0, 0, 0, 0.7);
         color: white;
         padding: 4px 8px;
         border-radius: 4px;
         font-size: 0.7rem;
         font-family: 'Courier New', monospace;
         opacity: 0;
         transition: opacity 0.3s ease;
      }

      .palette-color:hover::after {
         opacity: 1;
      }

      /* Mobile palette optimizations */
      @media (max-width: 767px) {
         .palette-preview {
            padding: 15px;
         }

         .palette-strip {
            height: 60px;
         }

         .palette-color:hover {
            flex: 1.1; /* Less dramatic expansion on mobile */
         }

         .palette-color::after {
            font-size: 0.6rem;
            padding: 3px 6px;
            bottom: 5px;
         }
      }

      /* Color Details */
      .color-details {
         background: white;
         padding: 20px;
         border-radius: 10px;
         border: 1px solid #e9ecef;
         margin-bottom: 20px;
      }

      .color-details h3 {
         color: #495057;
         margin-bottom: 15px;
         text-align: center;
      }

      .color-detail-item {
         display: flex;
         align-items: center;
         gap: 15px;
         padding: 12px;
         background: #f8f9fa;
         border-radius: 8px;
         margin-bottom: 12px;
      }

      .color-detail-preview {
         width: 50px;
         height: 50px;
         border-radius: 6px;
         border: 2px solid #e9ecef;
         flex-shrink: 0;
      }

      .color-detail-info {
         flex: 1;
      }

      .color-detail-hex {
         font-size: 1rem;
         font-weight: 700;
         color: #495057;
         font-family: 'Courier New', monospace;
         margin-bottom: 3px;
      }

      .color-detail-position {
         color: #6c757d;
         font-size: 0.85rem;
      }

      .copy-button {
         background: #667eea;
         color: white;
         border: none;
         padding: 8px 12px;
         border-radius: 5px;
         cursor: pointer;
         font-size: 0.85rem;
         transition: all 0.3s ease;
         min-height: 36px;
         min-width: 60px;
      }

      .copy-button:hover {
         background: #5a67d8;
      }

      .copy-button.copied {
         background: #28a745;
      }

      /* Mobile color details optimizations */
      @media (max-width: 767px) {
         .color-details {
            padding: 15px;
         }

         .color-detail-item {
            flex-direction: column;
            text-align: center;
            gap: 10px;
            padding: 15px;
         }

         .color-detail-preview {
            width: 60px;
            height: 60px;
         }

         .color-detail-hex {
            font-size: 1.1rem;
         }

         .color-detail-position {
            font-size: 0.9rem;
         }

         .copy-button {
            padding: 12px 20px;
            font-size: 0.9rem;
            width: 100%;
            max-width: 200px;
         }
      }

      /* Action Buttons */
      .action-buttons {
         display: flex;
         gap: 10px;
         justify-content: center;
         flex-wrap: wrap;
      }

      .btn-primary {
         background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
         color: white;
      }

      .btn-primary:hover {
         transform: translateY(-2px);
         box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
      }

      .btn-secondary {
         background: #6c757d;
         color: white;
      }

      .btn-secondary:hover {
         background: #5a6268;
      }

      .btn-danger {
         background: #dc3545;
         color: white;
      }

      .btn-danger:hover {
         background: #c82333;
      }

      /* Mobile action buttons */
      @media (max-width: 767px) {
         .action-buttons {
            flex-direction: column;
            gap: 12px;
         }

         .action-buttons .btn {
            width: 100%;
            padding: 16px 20px;
            font-size: 16px;
         }
      }

      /* Additional mobile optimizations */
      @media (max-width: 480px) {
         .container {
            margin: 5px;
         }

         .content {
            padding: 15px;
         }

         .combination-colors {
            flex-direction: column;
            align-items: center;
         }

         .color-box {
            width: 80px;
            height: 80px;
         }

         .palette-strip {
            height: 50px;
         }

         .color-details {
            padding: 12px;
         }

         .color-detail-item {
            padding: 12px;
         }
      }

      /* Export CSS Modal */
      .modal {
         display: none;
         position: fixed;
         z-index: 1000;
         left: 0;
         top: 0;
         width: 100%;
         height: 100%;
         background-color: rgba(0, 0, 0, 0.5);
         backdrop-filter: blur(5px);
         animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
         from { opacity: 0; }
         to { opacity: 1; }
      }

      .modal.show {
         display: flex;
         align-items: center;
         justify-content: center;
      }

      .modal-content {
         background: white;
         padding: 30px;
         border-radius: 15px;
         max-width: 600px;
         width: 90%;
         max-height: 80vh;
         overflow-y: auto;
         box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
         animation: slideUp 0.3s ease;
      }

      @keyframes slideUp {
         from {
            transform: translateY(50px);
            opacity: 0;
         }
         to {
            transform: translateY(0);
            opacity: 1;
         }
      }

      .modal-header {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: 20px;
         padding-bottom: 15px;
         border-bottom: 2px solid #e9ecef;
      }

      .modal-header h2 {
         margin: 0;
         color: #495057;
         font-size: 1.5rem;
      }

      .close-modal {
         background: none;
         border: none;
         font-size: 2rem;
         color: #6c757d;
         cursor: pointer;
         padding: 0;
         width: 30px;
         height: 30px;
         display: flex;
         align-items: center;
         justify-content: center;
         transition: all 0.2s ease;
      }

      .close-modal:hover {
         color: #dc3545;
         transform: rotate(90deg);
      }

      .modal-body {
         margin-bottom: 20px;
      }

      .css-preview {
         background: #282c34;
         color: #abb2bf;
         padding: 20px;
         border-radius: 8px;
         font-family: 'Courier New', Consolas, monospace;
         font-size: 0.9rem;
         line-height: 1.6;
         overflow-x: auto;
         margin-bottom: 20px;
         position: relative;
      }

      .css-preview pre {
         margin: 0;
         white-space: pre-wrap;
         word-wrap: break-word;
      }

      .css-comment {
         color: #5c6370;
      }

      .css-selector {
         color: #e06c75;
      }

      .css-property {
         color: #61afef;
      }

      .css-value {
         color: #98c379;
      }

      .modal-actions {
         display: flex;
         gap: 10px;
         flex-wrap: wrap;
      }

      .modal-actions .btn {
         flex: 1;
         min-width: 120px;
      }

      .btn-success {
         background: #28a745;
         color: white;
      }

      .btn-success:hover {
         background: #218838;
         transform: translateY(-2px);
         box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
      }

      .btn-info {
         background: #17a2b8;
         color: white;
      }

      .btn-info:hover {
         background: #138496;
         transform: translateY(-2px);
         box-shadow: 0 5px 15px rgba(23, 162, 184, 0.3);
      }

      /* Mobile modal adjustments */
      @media (max-width: 767px) {
         .modal-content {
            width: 95%;
            padding: 20px;
            max-height: 90vh;
         }

         .modal-header h2 {
            font-size: 1.2rem;
         }

         .css-preview {
            padding: 15px;
            font-size: 0.8rem;
         }

         .modal-actions {
            flex-direction: column;
         }

         .modal-actions .btn {
            width: 100%;
            min-width: auto;
         }
      }
   </style>
</head>

<body>
   <div class="container">
      <div class="header">
         <button class="theme-toggle" onclick="toggleTheme()" title="Cambiar tema" aria-label="Cambiar tema">
            <span class="icon">üåô</span>
         </button>
         <h1>Detalles de Combinaci√≥n</h1>
         <p>Visualiza y gestiona tu combinaci√≥n de colores</p>
      </div>

      <div class="content">
         <!-- Navigation -->
         <div class="nav-back">
            <a th:href="@{/combinations/}">‚Üê Volver a combinaciones</a>
         </div>

         <!-- Main Combination Display -->
         <div class="combination-display">
            <h1 class="combination-name" th:text="${combination.name}">Nombre de la Combinaci√≥n</h1>
            <div class="combination-meta">
               <span th:text="${combination.colorCount}">2</span> colores ‚Ä¢
               Creada el <span
                  th:text="${#temporals.format(combination.createdAt, 'dd/MM/yyyy HH:mm')}">01/01/2024</span>
            </div>

            <div class="combination-colors">
               <div class="color-display" th:each="color : ${combination.colors}">
                  <div class="color-box" th:style="'background-color: #' + ${color.hexValue}"
                     th:data-hex="${color.hexValue}" onclick="copyToClipboard('#' + this.dataset.hex)">
                  </div>
                  <div class="color-info">
                     <div class="color-hex" th:text="'#' + ${color.hexValue}">#FF5733</div>
                     <div class="color-position" th:text="'Color ' + ${color.position}">Color 1</div>
                  </div>
               </div>
            </div>
         </div>

         <!-- Palette Preview -->
         <div class="palette-preview">
            <h3>Vista de Paleta</h3>
            <div class="palette-strip">
               <div class="palette-color" th:each="color : ${combination.colors}"
                  th:style="'background-color: #' + ${color.hexValue}" th:data-hex="'#' + ${color.hexValue}"
                  onclick="copyToClipboard(this.dataset.hex)">
               </div>
            </div>
         </div>

         <!-- Color Details -->
         <div class="color-details">
            <h3>Detalles de Colores</h3>
            <div class="color-detail-item" th:each="color : ${combination.colors}">
               <div class="color-detail-preview" th:style="'background-color: #' + ${color.hexValue}"></div>
               <div class="color-detail-info">
                  <div class="color-detail-hex" th:text="'#' + ${color.hexValue}">#FF5733</div>
                  <div class="color-detail-position"
                     th:text="'Posici√≥n ' + ${color.position} + ' de ' + ${combination.colorCount}">Posici√≥n 1 de 2
                  </div>
               </div>
               <button class="copy-button" th:data-hex="${color.hexValue}"
                  onclick="copyToClipboard('#' + this.dataset.hex, this)">
                  Copiar
               </button>
            </div>
         </div>

         <!-- Action Buttons -->
         <div class="action-buttons">
            <button onclick="showExportModal()" class="btn btn-success">Exportar CSS</button>
            <a th:href="@{/combinations/{id}/edit(id=${combination.id})}" class="btn btn-primary">Editar Combinaci√≥n</a>
            <a th:href="@{/combinations/{id}/confirm-delete(id=${combination.id})}" class="btn btn-danger">Eliminar
               Combinaci√≥n</a>
            <a th:href="@{/combinations/}" class="btn btn-secondary">Volver a Lista</a>
         </div>
      </div>
   </div>

   <!-- Toast Notification -->
   <div id="toast" class="toast">
      Color copiado al portapapeles
   </div>

   <!-- Theme Initialization Script - Load before everything -->
   <script>
      // Theme Management - Load theme before page renders
      (function() {
         const savedTheme = localStorage.getItem('kolors-theme') || 'light';
         document.documentElement.setAttribute('data-theme', savedTheme);
         updateThemeIcon(savedTheme);
      })();

      function toggleTheme() {
         const currentTheme = document.documentElement.getAttribute('data-theme');
         const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

         // Apply theme
         document.documentElement.setAttribute('data-theme', newTheme);

         // Save to localStorage
         localStorage.setItem('kolors-theme', newTheme);

         // Update icon
         updateThemeIcon(newTheme);

         // Haptic feedback if available
         if (navigator.vibrate) {
            navigator.vibrate(50);
         }
      }

      function updateThemeIcon(theme) {
         const icon = document.querySelector('.theme-toggle .icon');
         if (icon) {
            icon.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
         }
      }
   </script>

   <!-- Export CSS Modal -->
   <div id="exportModal" class="modal">
      <div class="modal-content">
         <div class="modal-header">
            <h2>Exportar CSS Variables</h2>
            <button class="close-modal" onclick="closeExportModal()">&times;</button>
         </div>
         <div class="modal-body">
            <p style="color: #6c757d; margin-bottom: 15px;">
               Copia estas variables CSS o desc√°rgalas como archivo para usar en tus proyectos.
            </p>
            <div class="css-preview" id="cssPreview">
               <pre id="cssCode"></pre>
            </div>
         </div>
         <div class="modal-actions">
            <button onclick="copyCSSToClipboard()" class="btn btn-success">Copiar al Portapapeles</button>
            <button onclick="downloadCSS()" class="btn btn-info">Descargar .css</button>
            <button onclick="closeExportModal()" class="btn btn-secondary">Cerrar</button>
         </div>
      </div>
   </div>

   <script>
      function copyToClipboard(text, button) {
         navigator.clipboard.writeText(text).then(function () {
            showToast();

            if (button) {
               const originalText = button.textContent;
               button.textContent = '¬°Copiado!';
               button.classList.add('copied');

               setTimeout(() => {
                  button.textContent = originalText;
                  button.classList.remove('copied');
               }, 2000);
            }
         }).catch(function (err) {
            console.error('Error al copiar: ', err);

            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();

            try {
               document.execCommand('copy');
               showToast();

               if (button) {
                  const originalText = button.textContent;
                  button.textContent = '¬°Copiado!';
                  button.classList.add('copied');

                  setTimeout(() => {
                     button.textContent = originalText;
                     button.classList.remove('copied');
                  }, 2000);
               }
            } catch (err) {
               console.error('Fallback copy failed: ', err);
               alert('No se pudo copiar el color. Selecciona y copia manualmente: ' + text);
            }

            document.body.removeChild(textArea);
         });
      }

      function showToast() {
         const toast = document.getElementById('toast');
         toast.classList.add('show');

         setTimeout(() => {
            toast.classList.remove('show');
         }, 3000);
      }

      // Export CSS functionality
      function generateCSS() {
         const combinationName = /*[[${combination.name}]]*/ 'Combination';
         const colors = [];

         // Get all colors from the combination
         /*[# th:each="color : ${combination.colors}"]*/
         colors.push({
            position: /*[[${color.position}]]*/ 1,
            hex: /*[[${color.hexValue}]]*/ 'FFFFFF'
         });
         /*[/]*/

         // Sort by position
         colors.sort((a, b) => a.position - b.position);

         // Generate CSS code
         let css = `/* ${combinationName} - Color Palette */\n`;
         css += `/* Generated by Kolors */\n\n`;
         css += `:root {\n`;

         colors.forEach((color, index) => {
            // Generate variable name from combination name
            const varName = combinationName
               .toLowerCase()
               .replace(/[^a-z0-9]+/g, '-')
               .replace(/^-+|-+$/g, '');

            css += `  --${varName}-color-${index + 1}: #${color.hex};\n`;
         });

         css += `}\n\n`;
         css += `/* Usage example:\n`;
         css += ` * .element {\n`;
         css += ` *   background-color: var(--${combinationName.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '')}-color-1);\n`;
         css += ` *   color: var(--${combinationName.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '')}-color-2);\n`;
         css += ` * }\n`;
         css += ` */\n`;

         return css;
      }

      function showExportModal() {
         const modal = document.getElementById('exportModal');
         const cssCode = document.getElementById('cssCode');

         // Generate CSS
         const css = generateCSS();

         // Apply syntax highlighting
         cssCode.innerHTML = highlightCSS(css);

         // Show modal
         modal.classList.add('show');

         // Prevent body scroll
         document.body.style.overflow = 'hidden';

         // Close on outside click
         modal.onclick = function(event) {
            if (event.target === modal) {
               closeExportModal();
            }
         };
      }

      function closeExportModal() {
         const modal = document.getElementById('exportModal');
         modal.classList.remove('show');
         document.body.style.overflow = '';
      }

      function highlightCSS(css) {
         // Simple syntax highlighting
         return css
            .replace(/\/\*.*?\*\//g, '<span class="css-comment">$&</span>')
            .replace(/(:root|\.[\w-]+)/g, '<span class="css-selector">$&</span>')
            .replace(/(--[\w-]+):/g, '<span class="css-property">$1</span>:')
            .replace(/(#[0-9A-Fa-f]{6})/g, '<span class="css-value">$1</span>')
            .replace(/\n/g, '<br>');
      }

      function copyCSSToClipboard() {
         const css = generateCSS();

         if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(css).then(function() {
               // Update button text
               const btn = event.target;
               const originalText = btn.textContent;
               btn.textContent = '¬°Copiado!';
               btn.style.background = '#28a745';

               setTimeout(() => {
                  btn.textContent = originalText;
                  btn.style.background = '';
               }, 2000);

               // Show toast
               const toast = document.getElementById('toast');
               toast.textContent = 'CSS copiado al portapapeles';
               showToast();
            }).catch(function(err) {
               console.error('Error al copiar: ', err);
               fallbackCopyCSS(css);
            });
         } else {
            fallbackCopyCSS(css);
         }
      }

      function fallbackCopyCSS(css) {
         const textArea = document.createElement('textarea');
         textArea.value = css;
         textArea.style.position = 'fixed';
         textArea.style.left = '-9999px';
         document.body.appendChild(textArea);
         textArea.select();

         try {
            document.execCommand('copy');
            const toast = document.getElementById('toast');
            toast.textContent = 'CSS copiado al portapapeles';
            showToast();
         } catch (err) {
            alert('No se pudo copiar. Por favor, copia manualmente.');
         }

         document.body.removeChild(textArea);
      }

      function downloadCSS() {
         const combinationName = /*[[${combination.name}]]*/ 'combination';
         const css = generateCSS();

         // Create blob
         const blob = new Blob([css], { type: 'text/css' });
         const url = window.URL.createObjectURL(blob);

         // Create download link
         const a = document.createElement('a');
         a.href = url;
         a.download = `${combinationName.toLowerCase().replace(/[^a-z0-9]+/g, '-')}-colors.css`;
         document.body.appendChild(a);
         a.click();

         // Cleanup
         window.URL.revokeObjectURL(url);
         document.body.removeChild(a);

         // Show feedback
         const toast = document.getElementById('toast');
         toast.textContent = 'Archivo CSS descargado';
         showToast();
      }

      // Add click handlers to color boxes for better UX
      document.addEventListener('DOMContentLoaded', function () {
         const colorBoxes = document.querySelectorAll('.color-box');
         colorBoxes.forEach(box => {
            box.style.cursor = 'pointer';
            box.title = 'Haz clic para copiar el color';
         });

         const paletteColors = document.querySelectorAll('.palette-color');
         paletteColors.forEach(color => {
            color.style.cursor = 'pointer';
            color.title = 'Haz clic para copiar el color';
         });

         // Close modal with Escape key
         document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
               closeExportModal();
            }
         });
      });
   </script>

   <!-- Mobile Enhancement JavaScript -->
   <script th:src="@{/js/mobile-enhancements.js}"></script>
</body>

</html>
